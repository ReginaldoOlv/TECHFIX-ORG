<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TechFix â€” Painel Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Nunito:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --roxo:      #9b5de5;
      --roxo-c:    #c77dff;
      --roxo-e:    #6a0dad;
      --fundo:     #0a0a0f;
      --fundo2:    #100d1a;
      --card:      #1a1428;
      --texto:     #f0eaff;
      --suave:     #8b80a8;
      --borda:     rgba(155,93,229,0.2);
      --verde:     #25D366;
      --laranja:   #f59e0b;
      --vermelho:  #ef4444;
      --azul:      #3b82f6;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body { font-family: 'Nunito', sans-serif; background: var(--fundo); color: var(--texto); min-height: 100vh; }
    h1,h2,h3,h4 { font-family: 'Space Grotesk', sans-serif; }

    /* LOGIN */
    #tela-login {
      min-height: 100vh; display: flex; align-items: center; justify-content: center;
      background: radial-gradient(ellipse 80% 60% at 50% 0%, rgba(107,22,200,0.25) 0%, transparent 70%), var(--fundo);
    }
    .login-box {
      background: var(--card); border: 1px solid var(--borda); border-radius: 20px;
      padding: 2.5rem 2rem; width: 100%; max-width: 380px;
    }
    .login-logo {
      font-family: 'Space Grotesk', sans-serif; font-size: 1.6rem; font-weight: 700;
      background: linear-gradient(90deg, var(--roxo-c), var(--roxo));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: .3rem;
    }
    .login-logo span { color: white; -webkit-text-fill-color: white; }
    .login-box p { color: var(--suave); font-size: .85rem; margin-bottom: 1.8rem; }
    .l-campo { display: flex; flex-direction: column; gap: .3rem; margin-bottom: 1rem; }
    .l-campo label { font-size: .78rem; color: var(--suave); font-weight: 600; }
    .l-campo input {
      background: var(--fundo2); border: 1px solid var(--borda); border-radius: 10px;
      padding: .7rem 1rem; color: var(--texto); font-family: 'Nunito', sans-serif; font-size: .95rem; outline: none; transition: border-color .2s;
    }
    .l-campo input:focus { border-color: var(--roxo); }
    .btn-login {
      width: 100%; padding: .8rem; border-radius: 10px; border: none;
      background: linear-gradient(135deg, var(--roxo), var(--roxo-e));
      color: #fff; font-weight: 700; font-size: .95rem; cursor: pointer;
      font-family: 'Nunito', sans-serif; transition: opacity .2s; margin-top: .5rem;
    }
    .btn-login:hover { opacity: .9; }
    .login-erro {
      margin-top: .8rem; background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3);
      color: #f87171; padding: .6rem .9rem; border-radius: 8px; font-size: .83rem; display: none;
    }
    .login-erro.vis { display: block; }

    /* APP */
    #app { display: none; }

    .sidebar {
      position: fixed; top: 0; left: 0; width: 220px; height: 100vh;
      background: var(--fundo2); border-right: 1px solid var(--borda);
      display: flex; flex-direction: column; z-index: 50;
    }
    .sb-logo {
      padding: 1.4rem 1.3rem; border-bottom: 1px solid var(--borda);
      font-family: 'Space Grotesk', sans-serif; font-size: 1.25rem; font-weight: 700;
      background: linear-gradient(90deg, var(--roxo-c), var(--roxo));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .sb-logo span { color: white; -webkit-text-fill-color: white; }
    .sb-logo small { display: block; font-size: .62rem; color: var(--suave); -webkit-text-fill-color: var(--suave); font-family: 'Nunito', sans-serif; font-weight: 400; margin-top: .15rem; }
    .sb-menu { flex: 1; padding: .8rem 0; overflow-y: auto; }
    .mi {
      display: flex; align-items: center; gap: .7rem; padding: .72rem 1.3rem;
      cursor: pointer; color: var(--suave); font-size: .88rem; font-weight: 500;
      border-left: 3px solid transparent; transition: all .2s;
    }
    .mi:hover { background: rgba(155,93,229,0.07); color: var(--texto); }
    .mi.ativo { background: rgba(155,93,229,0.12); color: var(--roxo-c); border-left-color: var(--roxo-c); }
    .mi .ico { font-size: 1rem; width: 18px; text-align: center; }
    .sb-foot { padding: 1rem 1.3rem; border-top: 1px solid var(--borda); }
    .btn-sair {
      width: 100%; padding: .5rem; border-radius: 8px; border: 1px solid var(--borda);
      background: transparent; color: var(--suave); font-size: .8rem; cursor: pointer;
      font-family: 'Nunito', sans-serif; transition: all .2s;
    }
    .btn-sair:hover { border-color: var(--vermelho); color: var(--vermelho); }

    .conteudo { margin-left: 220px; padding: 2rem 2.5rem; min-height: 100vh; }
    .page { display: none; }
    .page.ativa { display: block; }

    .ph { margin-bottom: 1.8rem; }
    .ph h2 { font-size: 1.55rem; font-weight: 700; }
    .ph p  { color: var(--suave); font-size: .85rem; margin-top: .3rem; }

    /* MÃ‰TRICAS */
    .metricas { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px,1fr)); gap: 1rem; margin-bottom: 2rem; }
    .met {
      background: var(--card); border: 1px solid var(--borda); border-radius: 14px; padding: 1.2rem 1.4rem;
    }
    .met-l { font-size: .72rem; color: var(--suave); text-transform: uppercase; letter-spacing: .06em; margin-bottom: .45rem; }
    .met-v { font-size: 1.9rem; font-weight: 700; font-family: 'Space Grotesk', sans-serif; }
    .met-s { font-size: .75rem; color: var(--suave); margin-top: .25rem; }
    .met.roxo   .met-v { color: var(--roxo-c); }
    .met.verde  .met-v { color: var(--verde); }
    .met.lar    .met-v { color: var(--laranja); }
    .met.azul   .met-v { color: var(--azul); }

    /* TABELA */
    .tc { background: var(--card); border: 1px solid var(--borda); border-radius: 16px; overflow: hidden; margin-bottom: 1.5rem; }
    .tc-head {
      display: flex; align-items: center; justify-content: space-between;
      padding: 1rem 1.3rem; border-bottom: 1px solid var(--borda); flex-wrap: wrap; gap: .7rem;
    }
    .tc-head h3 { font-size: .95rem; font-weight: 700; }
    .tc-head .sub { font-size: .75rem; color: var(--suave); margin-top: .1rem; }
    .filtros { display: flex; gap: .5rem; flex-wrap: wrap; }
    .f-sel, .f-inp {
      background: var(--fundo2); border: 1px solid var(--borda); border-radius: 8px;
      padding: .38rem .75rem; color: var(--texto); font-family: 'Nunito', sans-serif; font-size: .8rem; outline: none;
    }
    .f-inp { width: 190px; }
    .f-inp::placeholder { color: var(--suave); }
    .f-sel:focus, .f-inp:focus { border-color: var(--roxo); }

    .ts { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: .845rem; }
    thead th {
      padding: .7rem 1rem; text-align: left; font-size: .7rem;
      text-transform: uppercase; letter-spacing: .05em; color: var(--suave);
      border-bottom: 1px solid var(--borda); white-space: nowrap;
    }
    tbody tr { border-bottom: 1px solid rgba(155,93,229,0.07); transition: background .15s; }
    tbody tr:last-child { border-bottom: none; }
    tbody tr:hover { background: rgba(155,93,229,0.04); }
    tbody td { padding: .75rem 1rem; vertical-align: middle; }
    .cel-nome { font-weight: 600; }
    .cel-suave { color: var(--suave); font-size: .8rem; }

    .badge {
      display: inline-block; padding: .2rem .65rem; border-radius: 50px;
      font-size: .7rem; font-weight: 700; letter-spacing: .02em; white-space: nowrap;
    }
    .b-novo     { background: rgba(59,130,246,0.15);  color: #60a5fa; }
    .b-andamento{ background: rgba(245,158,11,0.15);  color: #fbbf24; }
    .b-concluido{ background: rgba(37,211,102,0.15);  color: #4ade80; }
    .b-cancelado{ background: rgba(239,68,68,0.15);   color: #f87171; }
    .b-aprovado { background: rgba(37,211,102,0.15);  color: #4ade80; }
    .b-pendente { background: rgba(245,158,11,0.15);  color: #fbbf24; }

    .urg-urgente   { color: #f87171; font-weight: 700; font-size: .8rem; }
    .urg-semana    { color: #fbbf24; font-size: .8rem; }
    .urg-sempressa { color: #4ade80; font-size: .8rem; }

    .est { color: #f5a623; font-size: .78rem; letter-spacing: 1px; }

    .ba {
      background: none; border: 1px solid var(--borda); border-radius: 6px;
      padding: .28rem .6rem; color: var(--suave); cursor: pointer; font-size: .75rem;
      font-family: 'Nunito', sans-serif; transition: all .2s;
    }
    .ba:hover { border-color: var(--roxo); color: var(--roxo-c); }
    .ba.g:hover { border-color: var(--verde); color: var(--verde); }
    .ba.r:hover { border-color: var(--vermelho); color: var(--vermelho); }

    .ev { text-align: center; padding: 2.5rem 1rem; color: var(--suave); }
    .ev-i { font-size: 2.2rem; margin-bottom: .7rem; }
    .ev p { font-size: .87rem; }

    .ld { text-align: center; padding: 1.8rem; color: var(--suave); font-size: .88rem; }
    .sp {
      display: inline-block; width: 18px; height: 18px;
      border: 2px solid var(--borda); border-top-color: var(--roxo);
      border-radius: 50%; animation: gir .7s linear infinite;
      vertical-align: middle; margin-right: .5rem;
    }
    @keyframes gir { to { transform: rotate(360deg); } }

    /* MODAL DETALHES */
    .modal-det {
      position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 200;
      display: none; align-items: center; justify-content: center; padding: 1rem;
    }
    .modal-det.ab { display: flex; }
    .det-box {
      background: var(--fundo2); border: 1px solid var(--borda); border-radius: 20px;
      padding: 1.8rem; max-width: 540px; width: 100%; max-height: 90vh; overflow-y: auto;
    }
    .det-box h3 { font-size: 1.1rem; margin-bottom: 1.2rem; }
    .det-l {
      display: flex; justify-content: space-between; align-items: flex-start;
      padding: .45rem 0; border-bottom: 1px solid var(--borda); font-size: .85rem;
    }
    .det-l:last-of-type { border-bottom: none; }
    .det-l span:first-child { color: var(--suave); min-width: 120px; }
    .det-l span:last-child  { font-weight: 600; text-align: right; flex: 1; margin-left: .5rem; }
    .det-obs { margin-top: 1rem; }
    .det-obs label { font-size: .78rem; color: var(--suave); font-weight: 600; display: block; margin-bottom: .4rem; }
    .det-obs textarea {
      width: 100%; background: var(--card); border: 1px solid var(--borda); border-radius: 8px;
      padding: .6rem .8rem; color: var(--texto); font-family: 'Nunito', sans-serif;
      font-size: .85rem; outline: none; resize: vertical; min-height: 70px; transition: border-color .2s;
    }
    .det-obs textarea:focus { border-color: var(--roxo); }

    .det-acoes { display: flex; gap: .6rem; margin-top: 1.1rem; flex-wrap: wrap; }
    .btn-st {
      flex: 1; min-width: 110px; padding: .55rem; border-radius: 8px; border: none;
      font-weight: 700; font-size: .78rem; cursor: pointer; font-family: 'Nunito', sans-serif; transition: opacity .2s;
    }
    .btn-st:hover { opacity: .8; }
    .st-and { background: rgba(245,158,11,0.18); color: #fbbf24; border: 1px solid rgba(245,158,11,0.3); }
    .st-con { background: rgba(37,211,102,0.18); color: #4ade80; border: 1px solid rgba(37,211,102,0.3); }
    .st-can { background: rgba(239,68,68,0.15);  color: #f87171; border: 1px solid rgba(239,68,68,0.3); }
    .btn-fdet {
      background: transparent; border: 1px solid var(--borda); color: var(--suave);
      padding: .55rem 1rem; border-radius: 8px; cursor: pointer;
      font-family: 'Nunito', sans-serif; font-weight: 600; transition: all .2s;
    }
    .btn-fdet:hover { border-color: var(--roxo); color: var(--texto); }

    /* TOAST */
    .toast {
      position: fixed; bottom: 1.5rem; right: 1.5rem; z-index: 999;
      background: var(--card); border: 1px solid var(--borda); border-radius: 12px;
      padding: .85rem 1.2rem; font-size: .85rem; font-weight: 600;
      display: flex; align-items: center; gap: .5rem;
      transform: translateY(80px); opacity: 0; transition: all .3s; pointer-events: none;
    }
    .toast.vis { transform: translateY(0); opacity: 1; }
    .toast.v { border-color: rgba(37,211,102,0.4); color: #4ade80; }
    .toast.r { border-color: rgba(239,68,68,0.4); color: #f87171; }

    /* FORM NOVO SERVIÃ‡O */
    .form-serv {
      background: var(--card); border: 1px solid var(--borda); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem;
    }
    .form-serv h4 { font-size: .95rem; margin-bottom: 1rem; }
    .fs-grid { display: grid; grid-template-columns: 1fr 1fr; gap: .8rem; }
    .fs-campo { display: flex; flex-direction: column; gap: .3rem; }
    .fs-campo label { font-size: .75rem; color: var(--suave); font-weight: 600; }
    .fs-campo input, .fs-campo select, .fs-campo textarea {
      background: var(--fundo2); border: 1px solid var(--borda); border-radius: 8px;
      padding: .6rem .8rem; color: var(--texto); font-family: 'Nunito', sans-serif; font-size: .85rem; outline: none; transition: border-color .2s;
    }
    .fs-campo input:focus, .fs-campo select:focus { border-color: var(--roxo); }
    .fs-campo select option { background: var(--fundo2); }
    .btn-add-serv {
      margin-top: 1rem; background: linear-gradient(135deg, var(--roxo), var(--roxo-e));
      border: none; color: #fff; padding: .65rem 1.5rem; border-radius: 8px;
      font-weight: 700; font-size: .88rem; cursor: pointer; font-family: 'Nunito', sans-serif; transition: opacity .2s;
    }
    .btn-add-serv:hover { opacity: .9; }

    @media (max-width: 768px) {
      .sidebar { width: 100%; height: auto; position: relative; }
      .conteudo { margin-left: 0; padding: 1rem; }
      .metricas { grid-template-columns: 1fr 1fr; }
      .fs-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="tela-login">
  <div class="login-box">
    <div class="login-logo">Tech<span>Fix</span></div>
    <p>Painel administrativo â€” acesso restrito</p>
    <div class="l-campo">
      <label>E-mail</label>
      <input type="email" id="l-email" placeholder="admin@techfix.com.br"/>
    </div>
    <div class="l-campo">
      <label>Senha</label>
      <input type="password" id="l-senha" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')login()"/>
    </div>
    <button class="btn-login" onclick="login()">Entrar</button>
    <div class="login-erro" id="l-erro"></div>
  </div>
</div>

<!-- APP -->
<div id="app">
  <aside class="sidebar">
    <div class="sb-logo">Tech<span>Fix</span><small>Painel Admin</small></div>
    <nav class="sb-menu">
      <div class="mi ativo"   data-pg="dashboard"   onclick="ir(this)"><span class="ico">ğŸ“Š</span> Dashboard</div>
      <div class="mi"         data-pg="orcamentos"   onclick="ir(this)"><span class="ico">ğŸ“‹</span> OrÃ§amentos</div>
      <div class="mi"         data-pg="clientes"     onclick="ir(this)"><span class="ico">ğŸ‘¥</span> Clientes</div>
      <div class="mi"         data-pg="servicos"     onclick="ir(this)"><span class="ico">ğŸ”§</span> ServiÃ§os</div>
      <div class="mi"         data-pg="depoimentos"  onclick="ir(this)"><span class="ico">â­</span> Depoimentos</div>
    </nav>
    <div class="sb-foot">
      <div style="font-size:.72rem;color:var(--suave);margin-bottom:.5rem;text-align:center" id="user-label"></div>
      <button class="btn-sair" onclick="sair()">â†© Sair</button>
    </div>
  </aside>

  <main class="conteudo">

    <!-- DASHBOARD -->
    <div class="page ativa" id="page-dashboard">
      <div class="ph"><h2>Dashboard</h2><p id="saudacao">Bem-vindo ao painel TechFix</p></div>
      <div class="metricas">
        <div class="met roxo"><div class="met-l">OrÃ§amentos novos</div><div class="met-v" id="m1">â€”</div><div class="met-s">Aguardando atendimento</div></div>
        <div class="met lar"> <div class="met-l">Em andamento</div>   <div class="met-v" id="m2">â€”</div><div class="met-s">ServiÃ§os em execuÃ§Ã£o</div></div>
        <div class="met verde"><div class="met-l">ConcluÃ­dos</div>    <div class="met-v" id="m3">â€”</div><div class="met-s">Total histÃ³rico</div></div>
        <div class="met azul"><div class="met-l">Clientes</div>       <div class="met-v" id="m4">â€”</div><div class="met-s">Cadastrados</div></div>
      </div>
      <div class="tc">
        <div class="tc-head"><div><h3>Ãšltimos orÃ§amentos</h3><div class="sub">5 mais recentes</div></div></div>
        <div class="ts"><table>
          <thead><tr><th>Cliente</th><th>Dispositivo</th><th>ServiÃ§os</th><th>TÃ©cnico</th><th>UrgÃªncia</th><th>Status</th><th>Data</th></tr></thead>
          <tbody id="dash-tb"><tr><td colspan="7"><div class="ld"><span class="sp"></span>Carregando...</div></td></tr></tbody>
        </table></div>
      </div>
    </div>

    <!-- ORÃ‡AMENTOS -->
    <div class="page" id="page-orcamentos">
      <div class="ph"><h2>OrÃ§amentos</h2><p>Pedidos recebidos pelo formulÃ¡rio do site</p></div>
      <div class="tc">
        <div class="tc-head">
          <div><h3>Todos os orÃ§amentos</h3></div>
          <div class="filtros">
            <input class="f-inp" placeholder="ğŸ” Buscar cliente..." oninput="buscarOrc(this.value)"/>
            <select class="f-sel" onchange="filtroStatusOrc=this.value;renderOrc()">
              <option value="">Todos os status</option>
              <option value="novo">Novo</option>
              <option value="em_andamento">Em andamento</option>
              <option value="concluido">ConcluÃ­do</option>
              <option value="cancelado">Cancelado</option>
            </select>
          </div>
        </div>
        <div class="ts"><table>
          <thead><tr><th>Cliente</th><th>WhatsApp</th><th>Dispositivo</th><th>ServiÃ§os</th><th>UrgÃªncia</th><th>TÃ©cnico</th><th>Status</th><th>Data</th><th></th></tr></thead>
          <tbody id="tb-orc"><tr><td colspan="9"><div class="ld"><span class="sp"></span>Carregando...</div></td></tr></tbody>
        </table></div>
      </div>
    </div>

    <!-- CLIENTES -->
    <div class="page" id="page-clientes">
      <div class="ph"><h2>Clientes</h2><p>ProntuÃ¡rio de todos os clientes cadastrados</p></div>
      <div class="tc">
        <div class="tc-head">
          <div><h3>Base de clientes</h3></div>
          <div class="filtros">
            <input class="f-inp" placeholder="ğŸ” Buscar nome ou WhatsApp..." oninput="buscarCli(this.value)"/>
          </div>
        </div>
        <div class="ts"><table>
          <thead><tr><th>Nome</th><th>WhatsApp</th><th>Cidade</th><th>Cadastrado em</th><th></th></tr></thead>
          <tbody id="tb-cli"><tr><td colspan="5"><div class="ld"><span class="sp"></span>Carregando...</div></td></tr></tbody>
        </table></div>
      </div>
    </div>

    <!-- SERVIÃ‡OS -->
    <div class="page" id="page-servicos">
      <div class="ph"><h2>ServiÃ§os Realizados</h2><p>HistÃ³rico de atendimentos</p></div>

      <!-- FormulÃ¡rio para adicionar novo serviÃ§o -->
      <div class="form-serv">
        <h4>â• Registrar novo serviÃ§o</h4>
        <div class="fs-grid">
          <div class="fs-campo">
            <label>Cliente (WhatsApp)</label>
            <input type="text" id="fs-wpp" placeholder="41988880001"/>
          </div>
          <div class="fs-campo">
            <label>DescriÃ§Ã£o do serviÃ§o *</label>
            <input type="text" id="fs-desc" placeholder="Ex: Troca de tela Dell Inspiron"/>
          </div>
          <div class="fs-campo">
            <label>Dispositivo</label>
            <input type="text" id="fs-disp" placeholder="Notebook, Desktop..."/>
          </div>
          <div class="fs-campo">
            <label>Marca / Modelo</label>
            <input type="text" id="fs-marca" placeholder="Dell Inspiron 15"/>
          </div>
          <div class="fs-campo">
            <label>TÃ©cnico</label>
            <select id="fs-tec">
              <option value="Reginaldo">Reginaldo</option>
              <option value="Leonardo">Leonardo</option>
            </select>
          </div>
          <div class="fs-campo">
            <label>Valor cobrado (R$)</label>
            <input type="number" id="fs-val" placeholder="0.00" step="0.01"/>
          </div>
          <div class="fs-campo">
            <label>Data de entrada</label>
            <input type="date" id="fs-entrada"/>
          </div>
          <div class="fs-campo">
            <label>Status</label>
            <select id="fs-status">
              <option value="em_andamento">Em andamento</option>
              <option value="concluido">ConcluÃ­do</option>
            </select>
          </div>
        </div>
        <button class="btn-add-serv" onclick="adicionarServico()">Registrar serviÃ§o</button>
      </div>

      <div class="tc">
        <div class="tc-head">
          <div><h3>HistÃ³rico</h3></div>
          <div class="filtros">
            <select class="f-sel" onchange="filtroStatusServ=this.value;renderServ()">
              <option value="">Todos</option>
              <option value="em_andamento">Em andamento</option>
              <option value="concluido">ConcluÃ­do</option>
              <option value="cancelado">Cancelado</option>
            </select>
          </div>
        </div>
        <div class="ts"><table>
          <thead><tr><th>Cliente</th><th>DescriÃ§Ã£o</th><th>Dispositivo</th><th>TÃ©cnico</th><th>Valor</th><th>Entrada</th><th>SaÃ­da</th><th>Status</th><th></th></tr></thead>
          <tbody id="tb-serv"><tr><td colspan="9"><div class="ld"><span class="sp"></span>Carregando...</div></td></tr></tbody>
        </table></div>
      </div>
    </div>

    <!-- DEPOIMENTOS -->
    <div class="page" id="page-depoimentos">
      <div class="ph"><h2>Depoimentos</h2><p>Aprove avaliaÃ§Ãµes antes de exibir no site</p></div>
      <div class="tc">
        <div class="tc-head">
          <div><h3>AvaliaÃ§Ãµes recebidas</h3></div>
          <div class="filtros">
            <select class="f-sel" onchange="filtroDep=this.value;renderDep()">
              <option value="">Todos</option>
              <option value="false">Pendentes</option>
              <option value="true">Aprovados</option>
            </select>
          </div>
        </div>
        <div class="ts"><table>
          <thead><tr><th>Nome</th><th>ServiÃ§o</th><th>AvaliaÃ§Ã£o</th><th>ComentÃ¡rio</th><th>Status</th><th>Data</th><th></th></tr></thead>
          <tbody id="tb-dep"><tr><td colspan="7"><div class="ld"><span class="sp"></span>Carregando...</div></td></tr></tbody>
        </table></div>
      </div>
    </div>

  </main>
</div>

<!-- MODAL DETALHES ORÃ‡AMENTO -->
<div class="modal-det" id="modal-det" onclick="if(event.target===this)fecharDet()">
  <div class="det-box">
    <h3>ğŸ“‹ Detalhes do orÃ§amento</h3>
    <div id="det-corpo"></div>
    <div class="det-obs">
      <label>ObservaÃ§Ãµes internas (visÃ­vel sÃ³ aqui)</label>
      <textarea id="det-obs" placeholder="Anote peÃ§as, valores, prazo..."></textarea>
    </div>
    <div class="det-acoes">
      <button class="btn-st st-and" onclick="mudarStatus('em_andamento')">ğŸŸ¡ Em andamento</button>
      <button class="btn-st st-con" onclick="mudarStatus('concluido')">âœ… ConcluÃ­do</button>
      <button class="btn-st st-can" onclick="mudarStatus('cancelado')">âŒ Cancelado</button>
      <button class="btn-fdet" onclick="fecharDet()">Fechar</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>


<script>
  // â”€â”€â”€ CREDENCIAIS SUPABASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const SUPA_URL = 'https://pfigjyvhczzvcjseueoa.supabase.co';
  const SUPA_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBmaWdqeXZoY3p6dmNqc2V1ZW9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4NTE1NTEsImV4cCI6MjA4NzQyNzU1MX0.tl8aNDsA8ITt50oielqRz5Oja6xjLIR2xT8Khk3AqGk';
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  let TOKEN = '';
  let orcamentos=[], clientes=[], servicos=[], depoimentos=[];
  let orcAtivo = null;
  let filtroStatusOrc='', buscarOrcTxt='';
  let filtroStatusServ='';
  let filtroDep='';

  // â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function login() {
    const email = document.getElementById('l-email').value.trim();
    const senha = document.getElementById('l-senha').value;
    const erroEl = document.getElementById('l-erro');
    erroEl.classList.remove('vis');

    try {
      const r = await fetch(`${SUPA_URL}/auth/v1/token?grant_type=password`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'apikey': SUPA_KEY },
        body: JSON.stringify({ email, password: senha })
      });
      const d = await r.json();
      if (d.access_token) {
        TOKEN = d.access_token;
        document.getElementById('tela-login').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        const h = new Date().getHours();
        const s = h<12?'Bom dia':h<18?'Boa tarde':'Boa noite';
        document.getElementById('saudacao').textContent = `${s}, ${email.split('@')[0]} ğŸ‘‹`;
        document.getElementById('user-label').textContent = email;
        // Define hoje como data padrÃ£o no form de serviÃ§o
        document.getElementById('fs-entrada').value = new Date().toISOString().split('T')[0];
        carregarTudo();
      } else {
        erroEl.textContent = d.error_description || 'E-mail ou senha invÃ¡lidos.';
        erroEl.classList.add('vis');
      }
    } catch(e) {
      erroEl.textContent = 'Erro de conexÃ£o com o Supabase.';
      erroEl.classList.add('vis');
    }
  }

  function sair() { TOKEN=''; location.reload(); }

  // â”€â”€ NAVEGAÃ‡ÃƒO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function ir(el) {
    document.querySelectorAll('.mi').forEach(m=>m.classList.remove('ativo'));
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('ativa'));
    el.classList.add('ativo');
    document.getElementById('page-'+el.dataset.pg).classList.add('ativa');
  }

  // â”€â”€ SUPABASE FETCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function db(tabela, params='') {
    const r = await fetch(`${SUPA_URL}/rest/v1/${tabela}?${params}`, {
      headers: { 'apikey': SUPA_KEY, 'Authorization': `Bearer ${TOKEN}`, 'Prefer': 'count=exact' }
    });
    return r.json();
  }

  async function dbPatch(tabela, id, dados) {
    await fetch(`${SUPA_URL}/rest/v1/${tabela}?id=eq.${id}`, {
      method: 'PATCH',
      headers: { 'apikey': SUPA_KEY, 'Authorization': `Bearer ${TOKEN}`, 'Content-Type': 'application/json', 'Prefer': 'return=minimal' },
      body: JSON.stringify(dados)
    });
  }

  async function dbPost(tabela, dados) {
    const r = await fetch(`${SUPA_URL}/rest/v1/${tabela}`, {
      method: 'POST',
      headers: { 'apikey': SUPA_KEY, 'Authorization': `Bearer ${TOKEN}`, 'Content-Type': 'application/json', 'Prefer': 'return=representation' },
      body: JSON.stringify(dados)
    });
    return r.json();
  }

  // â”€â”€ CARREGAR TUDO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function carregarTudo() {
    [orcamentos, clientes, servicos, depoimentos] = await Promise.all([
      db('orcamentos', 'order=criado_em.desc'),
      db('clientes',   'order=criado_em.desc'),
      db('servicos_realizados', 'order=criado_em.desc'),
      db('depoimentos', 'order=criado_em.desc')
    ]);
    renderDashboard();
    renderOrc();
    renderCli();
    renderServ();
    renderDep();
  }

  // â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderDashboard() {
    document.getElementById('m1').textContent = orcamentos.filter(o=>o.status==='novo').length;
    document.getElementById('m2').textContent = orcamentos.filter(o=>o.status==='em_andamento').length;
    document.getElementById('m3').textContent = orcamentos.filter(o=>o.status==='concluido').length;
    document.getElementById('m4').textContent = clientes.length;

    const tb = document.getElementById('dash-tb');
    const ult = orcamentos.slice(0,5);
    if (!ult.length) { tb.innerHTML = vazio('Nenhum orÃ§amento ainda'); return; }
    tb.innerHTML = ult.map(o => {
      const cli = clientes.find(c=>c.id===o.cliente_id);
      return `<tr>
        <td class="cel-nome">${cli?.nome||o.cliente_id||'â€”'}</td>
        <td>${o.dispositivo}</td>
        <td>${(o.servicos||[]).join(', ')}</td>
        <td>${o.tecnico}</td>
        <td>${urgBadge(o.urgencia)}</td>
        <td>${badge(o.status)}</td>
        <td class="cel-suave">${fmtData(o.criado_em)}</td>
      </tr>`;
    }).join('');
  }

  // â”€â”€ ORÃ‡AMENTOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buscarOrc(v) { buscarOrcTxt=v.toLowerCase(); renderOrc(); }

  function renderOrc() {
    const tb = document.getElementById('tb-orc');
    let lista = orcamentos;
    if (filtroStatusOrc) lista = lista.filter(o=>o.status===filtroStatusOrc);
    if (buscarOrcTxt) {
      lista = lista.filter(o => {
        const cli = clientes.find(c=>c.id===o.cliente_id);
        return (cli?.nome||'').toLowerCase().includes(buscarOrcTxt) ||
               (cli?.whatsapp||'').includes(buscarOrcTxt);
      });
    }
    if (!lista.length) { tb.innerHTML = vazio('Nenhum orÃ§amento encontrado'); return; }
    tb.innerHTML = lista.map(o => {
      const cli = clientes.find(c=>c.id===o.cliente_id);
      return `<tr>
        <td class="cel-nome">${cli?.nome||'â€”'}</td>
        <td class="cel-suave">${fmtWpp(cli?.whatsapp||'')}</td>
        <td>${o.dispositivo} ${o.marca?`<span class="cel-suave">${o.marca}</span>`:''}</td>
        <td style="max-width:160px;font-size:.78rem">${(o.servicos||[]).join(', ')}</td>
        <td>${urgBadge(o.urgencia)}</td>
        <td>${o.tecnico}</td>
        <td>${badge(o.status)}</td>
        <td class="cel-suave">${fmtData(o.criado_em)}</td>
        <td><button class="ba" onclick='abrirDet(${JSON.stringify(o)})'>Ver</button></td>
      </tr>`;
    }).join('');
  }

  // â”€â”€ CLIENTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buscarCli(v) {
    const t = v.toLowerCase();
    const tb = document.getElementById('tb-cli');
    const lista = t ? clientes.filter(c=>c.nome.toLowerCase().includes(t)||c.whatsapp.includes(t)) : clientes;
    if (!lista.length) { tb.innerHTML = vazio('Nenhum cliente encontrado'); return; }
    tb.innerHTML = lista.map(c => {
      const total = orcamentos.filter(o=>o.cliente_id===c.id).length;
      return `<tr>
        <td class="cel-nome">${c.nome}</td>
        <td>${fmtWpp(c.whatsapp)}</td>
        <td class="cel-suave">${c.cidade||'â€”'}</td>
        <td><span class="badge b-novo">${total} pedido${total!==1?'s':''}</span></td>
        <td class="cel-suave">${fmtData(c.criado_em)}</td>
        <td>
          <a href="https://wa.me/55${c.whatsapp.replace(/\D/g,'')}" target="_blank" rel="noopener">
            <button class="ba g">WhatsApp</button>
          </a>
        </td>
      </tr>`;
    }).join('');
  }

  function renderCli() { buscarCli(''); }

  // â”€â”€ SERVIÃ‡OS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderServ() {
    const tb = document.getElementById('tb-serv');
    let lista = servicos;
    if (filtroStatusServ) lista = lista.filter(s=>s.status===filtroStatusServ);
    if (!lista.length) { tb.innerHTML = vazio('Nenhum serviÃ§o registrado'); return; }
    tb.innerHTML = lista.map(s => {
      const cli = clientes.find(c=>c.id===s.cliente_id);
      return `<tr>
        <td class="cel-nome">${cli?.nome||'â€”'}</td>
        <td>${s.descricao}</td>
        <td class="cel-suave">${s.dispositivo||''} ${s.marca||''}</td>
        <td>${s.tecnico||'â€”'}</td>
        <td>${s.valor_cobrado ? `R$ ${parseFloat(s.valor_cobrado).toFixed(2)}` : 'â€”'}</td>
        <td class="cel-suave">${s.data_entrada||'â€”'}</td>
        <td class="cel-suave">${s.data_saida||'â€”'}</td>
        <td>${badge(s.status)}</td>
        <td>
          <button class="ba g" onclick="concluirServico('${s.id}')">âœ“ Concluir</button>
        </td>
      </tr>`;
    }).join('');
  }

  async function adicionarServico() {
    const desc = document.getElementById('fs-desc').value.trim();
    if (!desc) { toast('Preencha a descriÃ§Ã£o do serviÃ§o.','r'); return; }

    const wpp  = document.getElementById('fs-wpp').value.trim().replace(/\D/g,'');
    const cli  = clientes.find(c=>c.whatsapp.replace(/\D/g,'')=== wpp);

    const dados = {
      cliente_id:   cli?.id || null,
      descricao:    desc,
      dispositivo:  document.getElementById('fs-disp').value.trim(),
      marca:        document.getElementById('fs-marca').value.trim(),
      tecnico:      document.getElementById('fs-tec').value,
      valor_cobrado:parseFloat(document.getElementById('fs-val').value)||null,
      data_entrada: document.getElementById('fs-entrada').value||null,
      status:       document.getElementById('fs-status').value
    };

    await dbPost('servicos_realizados', dados);
    toast('âœ… ServiÃ§o registrado!','v');
    // Limpar campos
    ['fs-desc','fs-disp','fs-marca','fs-val','fs-wpp'].forEach(id=>document.getElementById(id).value='');
    // Recarregar
    servicos = await db('servicos_realizados','order=criado_em.desc');
    renderServ();
    renderDashboard();
  }

  async function concluirServico(id) {
    const hoje = new Date().toISOString().split('T')[0];
    await dbPatch('servicos_realizados', id, { status:'concluido', data_saida: hoje });
    toast('âœ… ServiÃ§o concluÃ­do!','v');
    servicos = await db('servicos_realizados','order=criado_em.desc');
    renderServ();
    renderDashboard();
  }

  // â”€â”€ DEPOIMENTOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderDep() {
    const tb = document.getElementById('tb-dep');
    let lista = depoimentos;
    if (filtroDep !== '') lista = lista.filter(d=>String(d.aprovado)===filtroDep);
    if (!lista.length) { tb.innerHTML = vazio('Nenhum depoimento encontrado'); return; }
    tb.innerHTML = lista.map(d => `<tr>
      <td class="cel-nome">${d.nome}</td>
      <td class="cel-suave">${d.servico_desc||'â€”'}</td>
      <td><span class="est">${'â˜…'.repeat(d.estrelas)}${'â˜†'.repeat(5-d.estrelas)}</span></td>
      <td style="max-width:220px;font-size:.82rem">${d.texto}</td>
      <td>${d.aprovado ? '<span class="badge b-aprovado">Aprovado</span>' : '<span class="badge b-pendente">Pendente</span>'}</td>
      <td class="cel-suave">${fmtData(d.criado_em)}</td>
      <td style="display:flex;gap:.4rem">
        ${!d.aprovado ? `<button class="ba g" onclick="aprovarDep('${d.id}')">âœ“ Aprovar</button>` : ''}
        <button class="ba r" onclick="recusarDep('${d.id}')">âœ•</button>
      </td>
    </tr>`).join('');
  }

  async function aprovarDep(id) {
    await dbPatch('depoimentos', id, { aprovado: true });
    toast('âœ… Depoimento aprovado!','v');
    depoimentos = await db('depoimentos','order=criado_em.desc');
    renderDep();
  }

  async function recusarDep(id) {
    if (!confirm('Remover este depoimento?')) return;
    await fetch(`${SUPA_URL}/rest/v1/depoimentos?id=eq.${id}`, {
      method: 'DELETE',
      headers: { 'apikey': SUPA_KEY, 'Authorization': `Bearer ${TOKEN}` }
    });
    toast('Depoimento removido.','v');
    depoimentos = await db('depoimentos','order=criado_em.desc');
    renderDep();
  }

  // â”€â”€ MODAL DETALHE ORÃ‡AMENTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function abrirDet(o) {
    orcAtivo = o;
    const cli = clientes.find(c=>c.id===o.cliente_id);
    document.getElementById('det-corpo').innerHTML = `
      <div class="det-l"><span>ğŸ‘¤ Nome</span><span>${cli?.nome||'â€”'}</span></div>
      <div class="det-l"><span>ğŸ“ WhatsApp</span><span>${fmtWpp(cli?.whatsapp||'â€”')}</span></div>
      <div class="det-l"><span>ğŸ“ Cidade</span><span>${cli?.cidade||'â€”'}</span></div>
      <div class="det-l"><span>ğŸ’» Dispositivo</span><span>${o.dispositivo}</span></div>
      <div class="det-l"><span>ğŸ·ï¸ Marca/Modelo</span><span>${o.marca||'â€”'} ${o.modelo||''}</span></div>
      <div class="det-l"><span>ğŸ”§ ServiÃ§os</span><span>${(o.servicos||[]).join(', ')}</span></div>
      <div class="det-l"><span>âš ï¸ Problema</span><span>${o.problema}</span></div>
      <div class="det-l"><span>â±ï¸ UrgÃªncia</span><span>${o.urgencia||'â€”'}</span></div>
      <div class="det-l"><span>ğŸ‘¨â€ğŸ”§ TÃ©cnico</span><span>${o.tecnico}</span></div>
      <div class="det-l"><span>ğŸ“Œ Status</span><span>${badge(o.status)}</span></div>
      <div class="det-l"><span>ğŸ“… Recebido</span><span>${fmtData(o.criado_em)}</span></div>
    `;
    document.getElementById('det-obs').value = o.observacoes||'';
    document.getElementById('modal-det').classList.add('ab');
  }

  function fecharDet() { document.getElementById('modal-det').classList.remove('ab'); }

  async function mudarStatus(st) {
    if (!orcAtivo) return;
    const obs = document.getElementById('det-obs').value;
    await dbPatch('orcamentos', orcAtivo.id, { status: st, observacoes: obs });
    toast('âœ… Status atualizado!','v');
    fecharDet();
    orcamentos = await db('orcamentos','order=criado_em.desc');
    renderOrc(); renderDashboard();
  }

  // â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function badge(st) {
    const m = { novo:'b-novo', em_andamento:'b-andamento', concluido:'b-concluido', cancelado:'b-cancelado' };
    const l = { novo:'Novo', em_andamento:'Em andamento', concluido:'ConcluÃ­do', cancelado:'Cancelado' };
    return `<span class="badge ${m[st]||''}">${l[st]||st}</span>`;
  }

  function urgBadge(u) {
    if (!u) return 'â€”';
    const m = { 'Urgente':'urg-urgente','Esta semana':'urg-semana','Sem pressa':'urg-sempressa' };
    return `<span class="${m[u]||''}">${u}</span>`;
  }

  function fmtData(iso) {
    if (!iso) return 'â€”';
    return new Date(iso).toLocaleDateString('pt-BR', { day:'2-digit', month:'2-digit', year:'2-digit', hour:'2-digit', minute:'2-digit' });
  }

  function fmtWpp(n) {
    const d = (n||'').replace(/\D/g,'');
    if (d.length===11) return `(${d.slice(0,2)}) ${d.slice(2,7)}-${d.slice(7)}`;
    return n||'â€”';
  }

  function vazio(msg) {
    return `<tr><td colspan="20"><div class="ev"><div class="ev-i">ğŸ“­</div><p>${msg}</p></div></td></tr>`;
  }

  function toast(msg, tipo) {
    const el = document.getElementById('toast');
    el.textContent = msg;
    el.className = `toast ${tipo} vis`;
    setTimeout(() => el.classList.remove('vis'), 3000);
  }

  document.addEventListener('keydown', e => { if(e.key==='Escape') fecharDet(); });
</script>
</body>
</html>
